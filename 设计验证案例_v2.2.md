_# XP通用活动平台设计验证案例 (v2.2)_

**版本:** 2.2
**日期:** 2026年1月19日
**作者:** Manus AI

---

## 1. 验证场景与目标 (v2.2)

为验证v2.2设计方案（可派生任务模板 + 统一数据上下文），我们将活动场景从“首充”全面升级为更贴近博彩核心业务的“**新用户首注送Freebet**”活动。同时，根据您的要求，我们**简化了奖励部分的验证**，不再关心内部的记账细节，仅验证奖励发放API是否被正确调用。

### 1.1 活动规则描述 (v2.2)

活动面向近期注册且**已完成KYC 1级认证**的新用户。在活动期间内，用户完成**个人历史第一笔投注**，即可根据投注金额获得不同面值的**Freebet（免费投注券）**。

- **任务**: 完成个人历史第一笔投注（不限盘口、不限金额）。
- **奖励**: 
    - **档位一**: 首笔投注金额在 **R$20 (含) 到 R$100 (不含)**之间，奖励一张 **R$20 Freebet**。
    - **档位二**: 首笔投注金额 **大于等于 R$100**，奖励一张 **R$100 Freebet**。

---

## 2. 复合任务模板创建 (高阶运营)

在此次验证中，我们首先模拟**高阶运营**，使用v2.2的“任务模板设计中心”来创建一个全新的、可复用的“首注任务模板”。

**目标**: 创建一个能准确识别用户“历史首笔投注”行为的复合任务模板。

| 步骤 | 配置内容 |
| :--- | :--- |
| **1. 模板名称** | `通用首注任务模板` |
| **2. 模板ID** | `TPL_TASK_FIRST_BET` |
| **3. 选择基础事件** | `BASE_EVENT_USER_BET` (用户投注事件) |
| **4. 添加过滤条件** | `activity.task_completed_count == 0` <br> *（此处的`activity`是“统一数据上下文”的命名空间，`task_completed_count`代表该任务在本活动中被当前用户完成的次数。等于0即代表“首次”。）* |
| **5. 定义输出** | 将 `trigger.bet_amount` 传递给下游节点。<br> *（此处的`trigger`也是命名空间，代表了触发事件本身的数据。）* |

完成以上配置后，一个新的复合任务模板 `TPL_TASK_FIRST_BET` 就诞生了。它可以被任何需要“首注”这个条件的活动所复用。

---

## 3. ECA 逻辑配置 (一线运营)

接下来，**一线运营**使用刚刚创建的 `TPL_TASK_FIRST_BET` 模板来搭建“新用户首注送Freebet”活动。

### 3.1 逻辑流程图 (LogicFlow)

```mermaid
graph TD
    subgraph "活动组合配置向导"
        E[E: 事件触发<br/>通用首注任务模板<br/>TPL_TASK_FIRST_BET]:::event
        
        C0{C: 前置条件<br/>用户KYC等级是否 ≥ 1? }:::condition
        C1{C: 条件判断 1<br/>投注金额是否在 R$20-R$100? }:::condition
        C2{C: 条件判断 2<br/>投注金额是否 ≥ R$100? }:::condition
        
        A1[A: 动作执行 1<br/>调用发奖接口<br/>(Freebet, R$20)]:::action
        A2[A: 动作执行 2<br/>调用发奖接口<br/>(Freebet, R$100)]:::action
    end

    E -- 任务完成 --> C0
    C0 -- "是 (true)" --> C1
    C0 -- "否 (false)" --> End((结束))
    C1 -- "是 (true)" --> A1
    C1 -- "否 (false)" --> C2
    C2 -- "是 (true)" --> A2
    C2 -- "否 (false)" --> End
    A1 --> End
    A2 --> End

    classDef event fill:#B8E0D2,stroke:#2C7A7B,stroke-width:2px,color:black
    classDef condition fill:#FFE5B4,stroke:#D97706,stroke-width:2px,color:black
    classDef action fill:#D1FAE5,stroke:#059669,stroke-width:2px,color:black
```

### 3.2 节点配置详解 (v2.2)

| 节点类型 | 节点实例 | 配置详情 |
| :--- | :--- | :--- |
| **事件 (Event)** | `E: 通用首注任务` | - **操作**: 从“任务模板库”中拖拽 `TPL_TASK_FIRST_BET` 模板到画布。 |
| **条件 (Condition)** | `C0: KYC校验` | - **逻辑**: `user.kyc_level >= 1`<br> *（此处的`user`是“统一数据上下文”的命名空间，代表了用户的档案数据。）* |
| **条件 (Condition)** | `C1: 档位一判断` | - **逻辑**: `trigger.bet_amount >= 20 && trigger.bet_amount < 100`<br> *（此处的`trigger`代表了上游首注任务节点传递过来的数据。）* |
| **动作 (Action)** | `A1: 发放R$20 Freebet` | - **操作**: 添加一个“调用奖励接口”节点。<br>- **配置**: <br>  - `reward_type`: `FREEBET`<br>  - `reward_value`: `20` |
| **条件 (Condition)** | `C2: 档位二判断` | - **逻辑**: `trigger.bet_amount >= 100` |
| **动作 (Action)** | `A2: 发放R$100 Freebet` | - **操作**: 添加一个“调用奖励接口”节点。<br>- **配置**: <br>  - `reward_type`: `FREEBET`<br>  - `reward_value`: `100` |

---

## 4. 测试目标 (v2.2)

| 测试用户 | 用户行为 | 预期系统表现 |
| :--- | :--- | :--- |
| **用户A (符合档位一)** | 1. 注册，完成KYC 1级认证。<br>2. 首次投注 **R$50**。 | 1. 系统正确调用外部奖励API，参数为 `(user_id: 'user_A', reward_type: 'FREEBET', reward_value: 20)`。<br>2. 用户后续的任何投注，均不再触发此活动的奖励API调用。 |
| **用户B (符合档位二)** | 1. 注册，完成KYC 1级认证。<br>2. 首次投注 **R$150**。 | 1. 系统正确调用外部奖励API，参数为 `(user_id: 'user_B', reward_type: 'FREEBET', reward_value: 100)`。 |
| **用户C (未完成KYC)** | 1. 注册，未完成KYC认证。<br>2. 首次投注 **R$50**。 | 1. **不调用**任何奖励API。 |

通过这个全新的案例，我们验证了v2.2设计方案的核心优势：运营人员不仅可以**自行派生和定义任务**，还能在一个**清晰、无歧义的数据模型**下配置复杂的活动逻辑，极大地提升了平台的灵活性和健壮性。
