_# XP通用活动平台设计优化分析 (巴西博彩版)_

**版本:** 2.1
**日期:** 2026年1月19日
**作者:** Manus AI

---

## 1. 核心需求变更分析

根据您提供的最新信息，项目目标市场为**巴西体育博彩平台**。这引入了两个核心的设计变更驱动因素：**业务特殊性**和**合规强制性**。我们必须对原有的设计方案进行针对性升级，以确保产品不仅在商业上可行，在法律上也完全合规。

### 1.1 业务特殊性：奖励类型的扩展

博彩行业的核心奖励并非简单的“现金”，而是带有特定规则和约束的金融衍生品。我们的奖励体系必须从单一的现金模型，升级为支持多种行业标准奖励类型的复合模型。

| 奖励类型 | 核心特点 | 业务目标 |
| :--- | :--- | :--- |
| **Bonus (红利)** | - 存入用户独立的“红利账户”。<br>- **必须满足指定流水倍数** (Wagering/Rollover) 才能转为可提现的现金。<br>- 通常有有效期和适用游戏/赔率限制。 | 激励用户持续投注，增加平台流水。 |
| **Freebet (免费投注)** | - 一张具有特定面值的“投注券”。<br>- 用户可使用它进行投注，**无需花费本金**。<br>- 如果投注获胜，通常只返还**净利润**（奖金 - Freebet本金）。 | 降低用户尝试投注的门槛，鼓励体验新玩法或高赔率选项。 |
| **Cash (现金)** | - 直接存入用户主钱包，**可立即提现**。<br>- 在博彩行业中作为奖励较为少见，通常用于返水或特殊补偿。 | 最高价值的奖励，用于吸引或回馈高价值用户。 |

### 1.2 合规强制性：满足监管要求

巴西的博彩监管日趋严格，平台必须具备完善的追踪和风控能力，以应对审计和反洗钱 (AML) 调查。

- **资金流水可追溯**: 每一笔奖励的发放、使用、流转（如Bonus转为Cash）、过期、作废，都必须有**不可篡改的账本记录**。
- **条件前置校验**: 在发放高价值奖励前，可能需要强制校验用户的**KYC (身份认证) 等级**。
- **规则透明化**: 用户必须能清晰地看到每笔Bonus的流水要求、进度、有效期等信息。
- **风险控制**: 必须有能力识别和阻止滥用奖励规则的“刷子”用户。

---

## 2. 设计方案升级 (v2.1)

基于以上分析，我们将对**原子模板层**和**数据模型层**进行重点升级。

### 2.1 奖励原子模板体系重构

我们将创建两个全新的、高度可配置的奖励原子模板，以取代原有的“通用现金红包模板”。

#### 2.1.1 Bonus (红利) 奖励模板

**模板ID: `TPL_REWARD_BONUS`**

该模板封装了发放“红利”这一核心能力，并暴露了所有博彩业务所需的关键参数。

**暴露变量 (配置Schema):**

| 变量名 | 显示名称 | 控件类型 | 说明 |
| :--- | :--- | :--- | :--- |
| `bonus_amount` | 红利金额 | NumberInput | 发放的红利面值。 |
| `wagering_multiplier` | 流水倍数 | NumberInput | 用户需要完成多少倍于红利金额的有效投注额。例如：值为5，则100元Bonus需要500元流水。 |
| `validity_period_days` | 有效期(天) | NumberInput | 红利从发放到过期的时间。 |
| `min_odds` | 最低赔率 | NumberInput | 只有投注于大于等于该赔率的选项，才被计入有效流水。 |
| `applicable_games` | 适用游戏 | TagSelector | 指定该红利可用于哪些体育项目或游戏类型。 |

#### 2.1.2 Freebet (免费投注) 奖励模板

**模板ID: `TPL_REWARD_FREEBET`**

该模板封装了发放“免费投注券”的能力。

**暴露变量 (配置Schema):**

| 变量名 | 显示名称 | 控件类型 | 说明 |
| :--- | :--- | :--- | :--- |
| `freebet_value` | Freebet面值 | NumberInput | 这张免费投注券的金额。 |
| `return_type` | 返还类型 | Dropdown | `STAKE_NOT_RETURNED` (仅返还净利润) 或 `STAKE_RETURNED` (返还本金+利润)。 |
| `validity_period_days` | 有效期(天) | NumberInput | Freebet的有效使用期限。 |
| `min_odds` | 最低赔率 | NumberInput | 该Freebet可用于投注的最低赔率。 |

### 2.2 数据模型与合规性增强

为了满足合规要求，我们需要对数据表进行扩展。

- **`reward_ledger` (发奖账本表) 扩展**: 
    - 新增 `reward_meta` (JSON类型) 字段，用于存储该笔奖励的所有业务参数快照，如 `{ "wagering_multiplier": 5, "validity_period_days": 30 }`。这确保了即使模板后续被修改，我们也能准确追溯当时的发奖规则。

- **新增 `user_bonus_wallet` (用户红利钱包与流水追踪表)**:
    - 这是一张新表，用于**独立记录和追踪**每个用户获得的每一笔Bonus的状态。

| 字段名 | 数据类型 | 说明 |
| :--- | :--- | :--- |
| `id` | BIGINT | 唯一ID |
| `user_id` | VARCHAR(64) | 用户ID |
| `reward_ledger_id` | BIGINT | 关联到发奖账本的那条记录 |
| `bonus_amount` | DECIMAL | 初始红利金额 |
| `remaining_amount` | DECIMAL | 当前剩余的红利金额 |
| `wagering_requirement` | DECIMAL | 需要完成的总流水要求 (bonus_amount * wagering_multiplier) |
| `completed_wagering` | DECIMAL | 已完成的有效流水 |
| `status` | VARCHAR | 状态 (ACTIVE, COMPLETED, EXPIRED, FORFEITED) |
| `expires_at` | DATETIME | 过期时间 |

> **设计优势**: 通过这张独立的表，我们可以清晰地管理用户的每一笔Bonus，计算流水进度，并处理过期逻辑，完全满足监管对资金流转清晰可追溯的要求。

---

## 3. 下一步工作

1.  **更新产品设计文档**: 将上述变更正式写入 `产品设计文档_v2.1.md`。
2.  **更新验证案例**: 将“新用户首充激励活动”的奖励从“现金”替换为“**Bonus**”，并重新推演整个配置和测试流程，确保新设计能够完美支持博彩业务场景。
